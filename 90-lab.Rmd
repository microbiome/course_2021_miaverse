---
title: "Questions for Lab 1, 2 and 3"
author: "Leo lahti & Rajesh Shigdel"
date: "`r Sys.Date()`"
output: html_document
---

#Tutorial Aims 
In this tutorial we will learn feature selection, dimension reduction, clustering, visualization, analysis and interpretation  using  
 miaverse (mia = MIcrobiome Analysis) and miaViz - (Microbiome Analysis Plotting and Visualization) to explore patterns in human gut microbiome datasets. 

The example in this tutorial are mainly based on this online book        
[Orchestrating Microbiome Analysis](https://microbiome.github.io/OMA/)

In this tutorial we use [human gastrointestinal microbiota data](https://www.microbiomeatlas.org/)



   # Lab 1 
   
   
   ## unsupervised learning: Feature selection & dimension reduction
   
1. Make the tse (SummarizedExperiment) Object for the further analysis 

## Load the data 




```{r}

 samples_df <- read.csv(file ="HGMA.web.metadata.csv", 
               header = TRUE)

otu_mat <- read.csv(file ="HGMA.web.MSP.abundance.matrix.csv", 
               header = TRUE)

tax_mat <- read.table(file='IGC2.1989MSPs.taxo.tsv',sep = '\t', header = TRUE)

tree <- read.tree("IGC2.1990MSPs.nwk",text = NULL, tree.names = NULL, skip = 0,comment.char = "", keep.multi = FALSE)

```


```{r}
tax_mat <- tax_mat[,c("phylum", "class", "order", "family", "genus","species" )]
se <- TreeSummarizedExperiment(assays = list(counts = otu_mat[,rownames(samples_df)]),
                           colData = samples_df,
                           rowData = tax_mat[rownames(otu_mat),])
se
```

```{r}
tse <- as(se, "TreeSummarizedExperiment")
rowTree(tse) <- tree
```


```{r}
common.nodes <- intersect(rownames(tse), rowTree(tse)$tip.label)
tse <- TreeSummarizedExperiment::subsetByLeaf(x = tse, rowLeaf = common.nodes, updateTree = TRUE)
```



2. Aggregate the data to Phylum level 


3. Subset the data at the Species level with only taking bacterial Species that are greater than 10% of prevalence in the total sample


4. Subset a se object which consist only two phyla i.e Actinobacteria", "Cyanobacteria

 
5. Calculate relative abundances, and store the table to assays


6.Perform a centred log-ratio transformation (clr) (i.e. mia::transformSamples)



       # Lab 2 
       
  
       ## unsupervised learning: clustering & visualization
                   
 1. Visualize beta-diversity using principal coordinate analysis (PCoA);based on the Bray-Curtis dissimilarities


 2. Visualize beta-diversity using principal coordinates analysis (PCoA); with Aitchison distance (clr transformation+ Euclidean distance)


 3. Cluster the samples using Dirichlet- multinomial mixture model 


 4. Visualize the clusters in the PCoA plot



         # Lab 3 
         
                
         ## unsupervised learning:Analysis and interpretation 

 1. What taxa are driving the axis? Calculate the spearman correlation between PC1 and the relative abundance of the bacteria and visualize the results in a     bar plot.


 2. Visualize the dominant taxonomic group of each sample by colour on PCoA plot 

 3. Visualize gender by colour on PCoA plot 




